# 高级PID代码生成器插件

这是一个为YJ Studio插件框架设计的高级C语言PID控制器代码生成器。它可以根据用户在图形化界面中的详细配置，使用模板文件生成功能完整、可编译、功能丰富的PID控制器C语言代码。

## ✨ 功能特性

### 🎯 核心功能
- **多实例管理**: 支持在同一项目中创建和管理多个独立的PID控制器实例。
- **高级算法支持**: 基于高度可配置的模板，支持多种PID控制策略：
  - **标准PID**: P, I, D三项均作用于误差。
  - **PI-D**: P, I项作用于误差，D项作用于测量值，可减少设定值改变时的微分冲击。
  - **I-PD**: I项作用于误差，P, D项作用于测量值，可进一步消除设定值改变时的比例冲击。
- **位置/速度模式**: 支持生成位置式（输出绝对值）和速度式/增量式（输出变化量）代码。
- **参数实时配置**: 所有PID参数均可在UI中实时调整，并立刻反映在代码预览中。
- **代码模板化**: 使用强大的`advanced_pid_template.c/h`模板生成代码，易于扩展和定制。
- **语法高亮**: 内置C语言语法高亮，代码预览清晰易读。
- **实时预览与导出**: 参数修改后可实时预览头文件、源文件和`main`示例文件，并支持一键导出所有文件。

### ⚙️ 支持的参数与高级功能
- **PID系数**: Kp (比例), Ki (积分), Kd (微分)，支持连续域参数输入，自动转换为离散域。
- **前馈控制**: 支持前馈增益 (Kff) 和前馈权重。
- **输出限制**: 可配置最大/最小输出值。
- **抗积分饱和 (Anti-Windup)**:
  - 通过积分限幅 (Integral Clamping) 防止积分过度累积。
  - 通过积分分离 (Integral Separation) 在误差较大时暂停积分。
- **输出斜率限制**: 控制输出值的最大变化速率，使控制过程更平滑。
- **死区 (Deadband)**: 忽略指定范围内的微小误差，防止系统在稳态附近微小振荡。
- **滤波器**:
  - **微分先行滤波 (D-Term Filter)**: 平滑微分项，抑制测量噪声。
  - **测量值滤波 (Input Filter)**: 对输入测量值进行低通滤波。
  - **设定值滤波 (Setpoint Filter)**: 平滑设定值的变化。
- **数据类型**: 支持`float`和`double`两种数据类型。

## 📁 文件结构



```
panel_plugins/pid_code_generator/
├── init.py                    # 插件初始化文件
├── advanced_pid_generator.py      # 主要的UI组件和逻辑
├── test_template.py               # (已更新) 模板功能测试脚本
├── README.md                      # (已更新) 本说明文件
└── templates/                     # 代码模板目录
├── advanced_pid_template.c    # (已更新) 高级PID算法C源文件模板
├── advanced_pid_template.h    # 高级PID算法头文件模板
└── user_main_template.c       # main()函数示例代码模板
```
## 🚀 使用方法

1.  **添加与管理实例**:
    - 在左侧“PID控制器实例”面板中，输入实例名称（如 `motor_speed_pid`），点击“添加”。
    - 在列表中选择一个实例进行编辑。
    - 可随时“移除”或“重命名”选中的实例。

2.  **配置PID参数**:
    - 在右侧的“PID参数”选项卡中，为当前选中的实例配置核心参数、限制和高级控制功能。
    - **注意**: 积分(Ki)和微分(Kd)参数应输入其在**连续域**中的值，工具会自动根据采样时间进行离散化。

3.  **配置代码生成选项**:
    - 在“代码生成配置”选项卡中，配置全局代码风格，如结构体名称、函数前缀、头文件名等。这些配置将应用于所有实例生成的库文件。

4.  **预览和导出代码**:
    - 在“代码预览”选项卡中，可以在下拉菜单中选择预览`.c`源文件、`.h`头文件或`main.c`示例代码。
    - 点击“生成/刷新所有预览”按钮来更新所有代码。
    - 点击“导出代码文件”按钮，选择一个基础文件名和路径，即可将生成的`.c`, `.h` 和 `main.c` 文件保存到本地。

## 🔧 模板占位符说明

模板文件使用 `{{PLACEHOLDER}}` 格式进行参数替换。以下是主要占位符列表：

| 占位符名 | 说明 | 示例值 |
|---|---|---|
| `{{HEADER_NAME}}` | 头文件名 | `pid_controller.h` |
| `{{STRUCT_NAME}}` | C结构体名称 | `PID_HandleTypeDef` |
| `{{FUNCTION_PREFIX}}` | C函数前缀 | `PID` |
| `{{DATA_TYPE}}` | 数据类型 | `float` 或 `double` |
| `{{SFX}}` | 浮点数后缀 | `f` 或 ` ` |
| `{{TIMESTAMP}}` | 代码生成时间戳 | `2025-06-07 10:20:38` |
| `{{KP_DEFAULT}}`, `{{KI_DEFAULT}}`, ... | 所有PID参数的默认值 | `1.0f`, `0.01f`, ... |
| `{{ADAPTIVE_ENABLE}}`, `{{FUZZY_ENABLE}}`| 是否启用高级功能的布尔值| `true` 或 `false` |

---

**开发者**: YJ Studio Team
**版本**: 2.1.0